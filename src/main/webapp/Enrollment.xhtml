<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>University System - Enrollment Management</title>
    <h:outputStylesheet name="studentstyle.css" library="css" />
</h:head>

<h:body>
    <ui:include src="template/Header.xhtml"/>


    <br/>

    <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true"/>


<div>

    <p:commandButton
            value="Add Enrollment"
            actionListener="#{enrollmentBean.resetForm()}"
            update=":enrollmentForm"
            oncomplete="PF('enrollmentDialog').show();"
            styleClass="ui-button-success"
    />

    <h:form id="sortForm"
    style="text-align: right">
        <p:selectOneMenu value="#{enrollmentBean.sortField}"
                         style="margin-right: 5px;">
            <f:selectItem itemLabel="Select Field" itemValue="" />
            <f:selectItem itemLabel="Student Name" itemValue="student.name" />
            <f:selectItem itemLabel="Course Name" itemValue="course.name" />
            <f:selectItem itemLabel="Student ID" itemValue="student.id" />
            <f:selectItem itemLabel="Course ID" itemValue="course.id" />

        </p:selectOneMenu>

        <p:selectOneMenu value="#{enrollmentBean.sortOrder}"
                         style="margin-right: 5px;">
            <f:selectItem itemLabel="Ascending" itemValue="asc" />
            <f:selectItem itemLabel="Descending" itemValue="desc" />
        </p:selectOneMenu>

        <p:commandButton value="Sort" actionListener="#{enrollmentBean.sortEnrollments}"
                         update=":mainForm:enrollmentTable"
                         style="margin-right: 5px;"/>
    </h:form>

    <h:form id="globalFilterForm">
        <p:outputLabel for="globalFilter" value="Search ðŸ”Ž: "/>
        <p:inputText id="globalFilter" placeholder="Search for course or stundet names and ID's"
                        value="#{enrollmentBean.globalFilter}"
        style="width: 400px">
        </p:inputText>
    </h:form>
</div>

    <br/>
    <br/>

    <h:form id="mainForm">

        <!-- AFTER -->
        <p:dataTable id="enrollmentTable" value="#{enrollmentBean.enrollments}"
                     var="enrollment" rows="5" responsiveLayout="scroll"
                     styleClass="courses-table custom-datatable" rowHover="true"
                     paginator="true"
                     paginatorPosition="bottom"
                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     rowsPerPageTemplate="5,10,15,20,50"
                     currentPageReportTemplate="Showing {startRecord} - {endRecord} of {totalRecords} entries"
                     globalFilterFunction="#{enrollmentBean.globalFilterFunction}">

            <p:column headerText="Student ID">
                <h:outputText value="#{enrollment.id.studentId}" />
            </p:column>
            <p:column headerText="Course ID">
                <h:outputText value="#{enrollment.id.courseId}" />
            </p:column>
            <p:column headerText="Semester">
                <h:outputText value="#{enrollment.id.semester}" />
            </p:column>
            <p:column headerText="Course Name">
                <h:outputText value="#{enrollment.course.name}" />
            </p:column>
            <p:column headerText="Student Name">
                <h:outputText value="#{enrollment.student.name}" />
            </p:column>

            <p:column headerText="Status"
                      filterBy="#{enrollment.status}"
                      filterMatchMode="equals"
                      filterOptions="#{enrollmentBean.statusSelections}">
                <h:outputText value="#{enrollment.status}" />
            </p:column>

            <p:column headerText="Active"
                      filterBy="#{enrollment.active}"
                      filterMatchMode="equals"
                      filterOptions="#{enrollmentBean.activeSelections}"
                        filterValue="#{enrollmentBean.activeFilter}">
                <h:outputText value="#{enrollment.active}" />
            </p:column>

            <p:column headerText="Grade">
                <h:outputText value="#{enrollment.grade}" />
            </p:column>

            <p:column headerText="Enrollment Date">
                <h:outputText value="#{enrollment.enrollmentDate}" />
            </p:column>

            <p:column headerText="Actions">
                <p:commandButton icon="pi pi-pencil" title="Edit"
                                 actionListener="#{enrollmentBean.setSelectedEnrollment(enrollment)}"
                                 update=":enrollmentForm"
                                 oncomplete="PF('enrollmentDialog').show();"
                                 styleClass="ui-button-warning"
                                 style="margin-right: 5px;"
                />

                <p:commandButton icon="pi pi-trash" title="Delete"
                                 actionListener="#{enrollmentBean.deleteEnrollment(enrollment)}"
                                 update=":mainForm:enrollmentTable, :messages"
                                 onclick="return confirm('Are you sure you want to delete this enrollment?');"
                                 styleClass="ui-button-danger"
                />
            </p:column>
        </p:dataTable>
    </h:form>

    <p:dialog header="Add/Edit Enrollment" widgetVar="enrollmentDialog"
              modal="true" width="500" resizable="false">

        <div style="max-height:600px; overflow-y:auto; padding-right:10px;">
            <h:form id="enrollmentForm">
                <p:panelGrid columns="2" cellPadding="5">

                    <p:outputLabel for="studentId" value="Student ID *"/>
                    <p:inputText id="studentId" value="#{enrollmentBean.studentId}"
                                 required="true" requiredMessage="Student ID is required"/>

                    <p:outputLabel for="courseId" value="Course ID *"/>
                    <p:inputText id="courseId" value="#{enrollmentBean.courseId}"
                                 required="true" requiredMessage="Course ID is required"/>

                    <h:outputLabel for="semester" value="Semester *" />
                    <p:selectOneMenu id="semester" value="#{enrollmentBean.selectedSemester}"
                                     required="true" requiredMessage="Semester is required">
                        <f:selectItem itemLabel="Select Semester" itemValue="#{null}" />
                        <f:selectItems value="#{enrollmentBean.semesters}" var="semester"
                                       itemLabel="#{semester.name()}" itemValue="#{semester}" />
                    </p:selectOneMenu>

                    <h:outputLabel for="status" value="Status *" />
                    <p:selectOneMenu id="status" value="#{enrollmentBean.selectedEnrollment.status}"
                                     required="true" requiredMessage="Status is required">
                        <f:selectItem itemLabel="Select Status" itemValue="#{null}" />
                        <f:selectItems value="#{enrollmentBean.enrollmentStatuses}" var="status"
                                       itemLabel="#{status.name()}" itemValue="#{status}" />
                    </p:selectOneMenu>

                    <h:outputLabel for="grade" value="Grade" />
                    <p:selectOneMenu id="grade" value="#{enrollmentBean.selectedEnrollment.grade}">
                        <f:selectItem itemLabel="Select Grade" itemValue="#{null}" />
                        <f:selectItems value="#{enrollmentBean.grades}" var="grade"
                                       itemLabel="#{grade.name()}" itemValue="#{grade}" />
                    </p:selectOneMenu>

                    <h:outputLabel for="enrollmentDate" value="Enrollment Date" />
                    <p:calendar id="enrollmentDate" value="#{enrollmentBean.selectedEnrollment.enrollmentDate}"
                                pattern="yyyy-MM-dd" showOn="button"/>

                    <h:outputLabel for="active" value="Active" />
                    <h:selectBooleanCheckbox id="active" value="#{enrollmentBean.selectedEnrollment.active}" />

                </p:panelGrid>

                <div style="margin-top: 20px; text-align: right;">
                    <p:commandButton value="Cancel"
                                     type="button"
                                     onclick="PF('enrollmentDialog').hide();"
                                     styleClass="ui-button-secondary"
                                     style="margin-right: 10px;" />

                    <p:commandButton value="Save"
                                     action="#{enrollmentBean.saveEnrollment()}"
                                     update=":mainForm:enrollmentTable, :messages"
                                     oncomplete="if (args &amp;&amp; !args.validationFailed) PF('enrollmentDialog').hide();"
                                     styleClass="ui-button-success" />
                </div>
            </h:form>
        </div>
    </p:dialog>


    <br/>
    <br/>
    <br/>

    <ui:include src="template/Footer.xhtml"/>

</h:body>
</html>