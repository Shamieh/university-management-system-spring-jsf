<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>University System -Courses Management</title>
    <h:outputStylesheet name="studentstyle.css" library="css" />
</h:head>

<h:body>

    <!-- Main Form -->

        <ui:include src="template/Header.xhtml"/>


        <br/>

        <!-- Button to open dialog for adding new course -->
        <p:commandButton value="Add New Course"
                         actionListener="#{coursesBean.resetForm}"
                         update=":courseForm"
                         oncomplete="PF('courseDialog').show();"
                         styleClass="ui-button-success" />


        <hr/>

        <h:form id="sortForm"
                style="text-align: right">
            <p:selectOneMenu value="#{coursesBean.sortField}"
                             style="margin-right: 5px;">
                <f:selectItem itemLabel="Select Field" itemValue="" />
                <f:selectItem itemLabel="Course Name" itemValue="course.name" />
                <f:selectItem itemLabel="Course ID" itemValue="course.id" />

            </p:selectOneMenu>

            <p:selectOneMenu value="#{coursesBean.sortOrder}"
                             style="margin-right: 5px;">
                <f:selectItem itemLabel="Ascending" itemValue="asc" />
                <f:selectItem itemLabel="Descending" itemValue="desc" />
            </p:selectOneMenu>

            <p:commandButton value="Sort" actionListener="#{coursesBean.sortCourse()}"
                             update=":mainForm:courseTable"
                             style="margin-right: 5px;"/>
        </h:form>
    <h:form id="mainForm">

        <!-- Courses Table -->
        <h3>Courses List</h3>
        <p:dataTable id="courseTable" value="#{coursesBean.coursesList}" var="course"
                     rows="5" responsiveLayout="scroll"
                     styleClass="courses-table custom-datatable" rowHover="true"
                     paginator="true"
                     paginatorPosition="bottom"
                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     rowsPerPageTemplate="5,10,15,20,50"
                     currentPageReportTemplate="Showing {startRecord} - {endRecord} of {totalRecords} entries">

            <p:column headerText="ID">#{course.id}</p:column>
            <p:column headerText="Name">#{course.name}</p:column>
            <p:column headerText="Description">#{course.description}</p:column>
            <p:column headerText="Credit Hours">#{course.creditHours}</p:column>
            <!-- FIXED: Changed from 'active' to 'isActive' -->
            <p:column headerText="Active"><h:outputText value="#{course.isActive ? 'Yes' : 'No'}" /></p:column>
            <p:column headerText="Faculty">#{course.faculty.name}</p:column>
            <p:column headerText="Max Capacity">#{course.maxCapacity}</p:column>
            <p:column headerText="Current Enrollments">#{course.currentEnrollment}</p:column>


            <!-- Actions Column -->
            <p:column headerText="Actions">

                <!-- Edit Course -->
                <p:commandButton icon="pi pi-pencil" title="Edit"
                                 actionListener="#{coursesBean.setSelectedCourse(course)}"
                                 update=":courseForm"
                                 oncomplete="PF('courseDialog').show();"
                                 styleClass="ui-button-warning" />

                <!-- Delete Course -->
                <p:commandButton icon="pi pi-trash" title="Delete"
                                 actionListener="#{coursesBean.deleteCourse(course)}"
                                 update=":mainForm:courseTable"
                                 onclick="return confirm('Are you sure you want to delete this course?');"
                                 styleClass="ui-button-danger" />

            </p:column>
        </p:dataTable>

    </h:form>

    <!-- Popup Dialog for Add/Edit Course -->
    <p:dialog header="Add/Edit Course" widgetVar="courseDialog"
              modal="true" resizable="false" width="400">

        <h:form id="courseForm">
            <h:panelGrid columns="2" cellpadding="5">

                <h:outputLabel for="name" value="Course Name:" />
                <h:inputText id="name" value="#{coursesBean.selectedCourse.name}" required="true" />

                <h:outputLabel for="description" value="Description:" />
                <h:inputText id="description" value="#{coursesBean.selectedCourse.description}" required="true" />

                <h:outputLabel for="credithours" value="Credit Hours:" />
                <h:inputText id="credithours" value="#{coursesBean.selectedCourse.creditHours}" required="true" />


                <h:outputLabel for="active" value="Active:" />
                <!-- FIXED: Changed from 'active' to 'isActive' -->
                <h:selectBooleanCheckbox id="active" value="#{coursesBean.selectedCourse.isActive}" />
                <br/>

                <h:outputLabel for="faculty" value="Faculty:" />
                <p:selectOneMenu id="faculty" value="#{coursesBean.selectedFacultyId}" required="true">
                    <f:selectItem itemLabel="Select Faculty" itemValue="" />
                    <f:selectItems value="#{coursesBean.facultyList}" var="f" itemLabel="#{f.name}" itemValue="#{f.id}" />
                </p:selectOneMenu>

            </h:panelGrid>

            <p:commandButton value="Save"
                             action="#{coursesBean.saveCourse}"
                             update=":mainForm:courseTable"
                             oncomplete="PF('courseDialog').hide();"
                             style="margin-top:10px;" />
        </h:form>

    </p:dialog>

    <br/>
    <br/>
    <br/>

    <ui:include src="template/Footer.xhtml"/>


</h:body>
</html>